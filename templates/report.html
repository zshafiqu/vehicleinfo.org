{% extends "layout.html" %}
{% block content %}
<!-- BEGIN SEARCH FORM -->
<div class="row">
	<div class="col-md-12">
		<div class="card" style="padding:1rem;">
			<div class="">
				<h4 class="title" style="margin:0rem;">Search By Year Make and Model</h4>
			</div>
			<div class="content">
				<form action="/handlerequest" method="post">
					<div class="row">
						<div class="col-md-3">
							<div class="form-group">
								<label>Year</label> <input autofocus="" class="form-control border-input" name="year" placeholder="" type="text">
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
								<label>Make</label> <input class="form-control border-input" name="make" placeholder="" type="text">
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
								<label>Model</label> <input class="form-control border-input" name="model" placeholder="" type="text">
							</div>
						</div>
						<div class="col-md-3" style="display:flex; align-items:center; justify-content:center; padding-top:.75rem">
							<button class="btn btn-wd btn-warning btn-fill btn-magnify" type="submit" value="submit"><span class="btn-label"></span>Search</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!-- END SEARCH FORM -->
<!-- BEGIN ROW 1 -->
<div class="row">
  <!-- BEGIN LEFT CARD -->
  <div class="col-md-5">
      <div class="card" style="padding:1rem;">
          <div class="header" style="margin:0rem;">
              <h4 class="title" style="margin-top:0rem;">
                {{data['Results'][0]['Year']}}
                {{data['Results'][0]['Make']}}
                {{data['Results'][0]['Model']}}
              </h4>
          </div>
          <div class="content" style="padding:.5rem;">
              {% set temp = data['Results'][0]['Styles'][0] %}
              <img style="padding-left:0rem;" src="{{ data['Results'][0]['Images'][temp] }}" alt="">
          </div>
          <div class="footer">
              <hr>
              <div class="stats">
                  <strong><b>Available Style(s):</b>
                    {% for style in data['Results'][0]['Styles'] %}
                      {% if style == data['Results'][0]['Styles'][-1] %}
                        {{ style }}
                      {% else %}
                        {{ style }},
                      {% endif %}
                    {% endfor %}
                  </strong>
              </div>
          </div>
      </div>
  </div>
  <!-- END LEFT CARD -->
  <!-- BEGIN RIGHT CARD -->
  <div class="col-md-7">
    <div class="card" style="padding:1rem;">
        <div class="header" style="margin:0rem;">
            <h4 class="title" style="margin-top:0rem;">Style & Trims</h4>
        </div>
        <!-- Card Content -->
        <div class="card-content">
          <div class="panel-group">
            <!-- BEGIN PANEL ITEM -->
            <!-- For each body style in Trims object -->
            {% for style in data['Results'][0]['Trims'] %}
              <div class="panel panel-border panel-default">
                <!-- Need to set hypertext ref based on style so dropdown knows where to point to -->
                <a data-toggle="collapse" href="#{{style}}">
                  <div class="panel-heading">
                    <h4 class="panel-title">{{style}}</h4>
                  </div>
                </a>
                <!-- Set ID for dropdown according to style too -->
                <div id="{{style}}" class="panel-collapse collapse">
                  <div class="panel-body">
                    <!-- HTML for dynamic table -->
                    <div class="card card-plain" style="margin-bottom:0em;">
                      <div class="content table-responsive table-full-width" style="padding-bottom:0em;">
                        <table class="table table-hover">
                          <!-- START HEAD -->
                          <!-- Set data for table HEADER based on available attributes -->
                          <thead>
                            <tr>
                              <!-- Leftmost is trim by default -->
                              <th>Trim</th>
                              <!-- For each trim -->
                              {% for trim in data['Results'][0]['Trims'][style] %}
                              <!-- For each available attribute in the first instance of this style (hence the loop.first exit condition )-->
                                {% for attribute in data['Results'][0]['Trims'][style][trim] if loop.first %}
                                  <!-- Add this attribute to our header -->
                                  <th>{{attribute}}</th>
                                <!-- End inner loop -->
                                {% endfor %}
                              <!-- End outer loop -->
                              {% endfor %}
                            </tr>
                          </thead>
                          <!-- END HEAD -->
                          <!-- START BODY -->
                          <tbody>
                            <!-- For each trim in each style -->
                            {% for trim in data['Results'][0]['Trims'][style] %}
                            <tr>
                              <!-- Leftmost is the trim by default -->
                              <td>{{trim}}</td>
                              <!-- For each attribute, get its value -->
                              {% for value in data['Results'][0]['Trims'][style][trim] %}
                                <td>{{data['Results'][0]['Trims'][style][trim][value]}}</td>
                              {% endfor %}
                            </tr>
                            {% endfor %}
                          </tbody>
                          <!-- END BODY -->
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
            <!-- END PANEL ITEM -->
          </div>
        <div><hr></div>
      </div>
    </div>
  </div>
  <!-- END RIGHT CARD -->
</div>
<!-- END ROW 1 -->
<!-- BEGIN ROW 2 -->
<div class="row">
  <!-- BEGIN RECALLS CARD -->
  <div class="col-md-12">
    <div class="card" style="padding:1rem;">
      <div class="header" style="margin:0rem;">
        <h4 class="title" style="margin-top:0rem;">Recalls for the
          {{data['Results'][0]['Year']}}
          {{data['Results'][0]['Make']}}
          {{data['Results'][0]['Model']}}
        </h4>
      </div>
      <div class="content" style="padding:.5rem;">
        <div class="content table-responsive table-full-width">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Recall Number</th>
                <th>Report Date</th>
                <th>Summary</th>
                <th>Consequence</th>
                <th>Remedy</th>
              </tr>
            </thead>
            <tbody>
              {% for info in recalls['Results']|reverse %}
                <tr id="{{loop.index}}">
                  <td><small>{{ info['NHTSACampaignNumber'] }}</small></td>
                  <td><small>{{ info['ReportReceivedDate']|strftime }}</small></td>
                  <td><small>{{ info['Summary']|capitalize }}</small></td>
                  <td><small>{{ info['Conequence']|capitalize }}</small></td>
                  <td><small>{{ info['Remedy']|capitalize }}</small></td>
                </tr>
                {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="footer">
        <hr>
        <div class="stats">
          <strong><b>Source:</b> NHTSA</strong>
        </div>
      </div>
    </div>
  </div>
  <!-- END RECALLS CARD -->
</div>
<!-- END ROW 2 -->
<!-- BEGIN ROW 3 -->
<div class="row">
  <div class="col-md-12">
    <div class="card" style="padding:1rem;">
      <div class="header" style="margin:0rem;">
        <h4 class="title" style="margin-top:0rem;">Consumer complaints for the
          {{data['Results'][0]['Year']}}
          {{data['Results'][0]['Make']}}
          {{data['Results'][0]['Model']}}
        </h4>
      </div>
      <div class="content" style="padding:.5rem;">
        <div class="content table-responsive table-full-width">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Incident Date</th>
                <th>Affected Component</th>
                <th>Summary</th>
              </tr>
            </thead>
            <tbody>
              {% for info in complaints['Results']|reverse %}
                <tr id="{{loop.index}}">
                  <td><small>{{ info['DateComplaintFiled']|strftime }}</small></td>
                  <td><small>{{ info['Component']|capitalize }}</small></td>
                  <td><small>{{ info['Summary']|capitalize }}</small></td>
                </tr>
                {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="footer">
        <hr>
        <div class="stats">
          <strong><b>Source:</b> NHTSA</strong>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
